<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Circular Genome View</title>
    <!-- The commented scripts below are the minified production versions of the
      other scripts -->
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin="anonymous"></script>
    <!--    <script src="https://unpkg.com/@jbrowse/react-circular-genome-view/dist/react-circular-genome-view.umd.development.js"
                crossorigin="anonymous"></script>-->
    <script
            src="https://unpkg.com/@jbrowse/react-circular-genome-view/dist/react-circular-genome-view.umd.production.min.js"
            crossorigin="anonymous"
    ></script>

    <!--    <script src="https://unpkg.com/react@16/umd/react.production.min.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" crossorigin></script>
        <script src="https://unpkg.com/@jbrowse/react-circular-genome-view/dist/react-circular-genome-view.umd.production.min.js"
                crossorigin></script>-->
    <style>
        button[data-testid='circular_track_select'] {
            display: none;
        }
    </style>
</head>
<body>

<p>
    <button id="hg19">Genome hg19</button>
    <button id="mm10">Genome mm10</button>
    <button id="sniffles">Sniffles</button>
    <button id="delly">Delly</button>
</p>

<div id="jbrowse_circular_genome_view" style="width: 800px; height: 800px; border: black; border-style: solid; background: white"></div>


<script type="module">

    import CircularView from "../js/circularView.js";

    import hg19 from "./hg19.js";
    import mm10 from "./mm10.js"
    import snifflesTrack from "./snifflesTrack.js";
    import dellyTrack from "./dellyTrack.js";

    const el = document.getElementById('jbrowse_circular_genome_view');
    const config = {
        onChordClick: (feature) => {
            const f1 = feature.data;
            const f2 = f1.mate;
            const flanking = 2000;
            const s1 = Math.max(0, f1.start - flanking);
            const e1 = f1.end + flanking;
            const s2 = Math.max(0, f2.start - flanking);
            const e2 = f2.end + flanking;
            const searchString = `goto ${f1.refName}:${s1}-${e1} ${f2.refName}:${s2}-${e2}\r\n`
            console.log(searchString);
        }
    }

    const circularView = new CircularView(el, config);

    document.getElementById("hg19").addEventListener("click", e => circularView.setAssembly(hg19));
    document.getElementById("mm10").addEventListener("click", e => circularView.setAssembly(mm10));
    document.getElementById("sniffles").addEventListener("click", e => toggleTrack(e, snifflesTrack));
    document.getElementById("delly").addEventListener("click", e => toggleTrack(e, dellyTrack));

    function toggleTrack(e, track) {
        const t = circularView.getTrack(track.name);
        if(!t) {
            e.target.style.backgroundColor = track.color;
            circularView.addChords(track.chords, {track: track.name, color: track.color})
        } else {
            if(t.visible) {
                circularView.hideTrack(track.name);
            } else {
                circularView.showTrack(track.name);
            }
        }
    }

</script>

</body>
</html>
