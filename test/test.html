<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Circular Genome View</title>

    <!-- Vanilla Picker CSS -->
<!--    <link rel="stylesheet" href="../css/vanilla-picker.csp.css">-->

    <!-- CSS -->
    <link rel="stylesheet" href="../css/circular-view.css">

    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@jbrowse/react-circular-genome-view/dist/react-circular-genome-view.umd.production.min.js"></script>

    <!-- Vanilla Picker JS -->
<!--    <script src="../js/vanilla-picker.csp.js"></script>-->


</head>
<body>

<p>
    <button id="hg19">Genome hg19</button>
    <button id="mm10">Genome mm10</button>
    <label for="size-input">
        <input id="size-input" type="text" name="circular-view-size">
        Set Size
    </label>
</p>
<p>
    Sniffles:
    <button id="sifflesLoad">Load</button>
</p>
<p>
    Delly:
    <button id="dellyLoad">Load</button>
</p>

<div class='jbrowse-container'></div>

<script type="module">

    import CircularView from "../js/circularView.js";

    import hg19 from "./hg19.js";
    import mm10 from "./mm10.js"
    import snifflesData from "./snifflesTrackData.js";
    import dellyData from "./dellyTrackData.js";

    const config =
        {
            assembly: hg19,
            onChordClick: (feature) => {
                const f1 = feature.data;
                const f2 = f1.mate;
                const flanking = 2000;
                const s1 = Math.max(0, f1.start - flanking);
                const e1 = f1.end + flanking;
                const s2 = Math.max(0, f2.start - flanking);
                const e2 = f2.end + flanking;
                const searchString = `goto ${f1.refName}:${s1}-${e1} ${f2.refName}:${s2}-${e2}\r\n`
                console.log(searchString);
            }
        }

    const circularView = new CircularView(document.querySelector('.jbrowse-container'), config);

    circularView.setSize(768)

    document.getElementById("hg19").addEventListener("click", e => circularView.setAssembly(hg19));
    document.getElementById("mm10").addEventListener("click", e => circularView.setAssembly(mm10));

    document.getElementById('size-input').addEventListener('keyup', event => {
        event.preventDefault()
        event.stopPropagation()
        if (13 === event.keyCode) {
            circularView.setSize(Number.parseInt(event.target.value))
        }
    })

    document.getElementById("sifflesLoad").addEventListener("click", e => loadTrack(snifflesData));
    document.getElementById("dellyLoad").addEventListener("click", e => loadTrack(dellyData));

    function loadTrack(data) {
        const track = data.track;
        const chords = data.chords;
        circularView.addChords(chords, track);
    }

    function toggleTrack(e, id) {
        const t = circularView.getTrack(id);
        if(t) {
            // Toggle visibility
            if (t.visible) {
                circularView.hideTrack(id);
                e.target.innerText = "Show"
            } else {
                circularView.showTrack(id);
                e.target.innerText = "Hide";
            }
        }
    }

    function colorTrack(id) {
        const color = `rgb(${Math.floor(Math.random() * 255)},${Math.floor(Math.random() * 255)},${Math.floor(Math.random() * 255)})`;
        circularView.setTrackColor(id, color);
    }

    function alphaTrack(id, value) {
        const alpha = Number(value);
        circularView.setTrackAlpha(id, alpha);
    }


</script>

</body>
</html>
